!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var a=t();for(var o in a)("object"==typeof exports?exports:e)[o]=a[o]}}(this,function(){return function(e){function t(o){if(a[o])return a[o].exports;var i=a[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var a={};return t.m=e,t.c=a,t.i=function(e){return e},t.d=function(e,a,o){t.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=6)}([function(e,t,a){e.exports=a(5).default},function(e,t){},function(e,t){e.exports=function(e,t,a,o){var i,n=e=e||{},s=typeof e.default;"object"!==s&&"function"!==s||(i=e,n=e.default);var r="function"==typeof n?n.options:n;if(t&&(r.render=t.render,r.staticRenderFns=t.staticRenderFns),a&&(r._scopeId=a),o){var c=Object.create(r.computed||null);Object.keys(o).forEach(function(e){var t=o[e];c[e]=function(){return t}}),r.computed=c}return{esModule:i,exports:n,options:r}}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"amap-search__container",style:{width:e.width+"px",height:e.height+"px"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.showSearch,expression:"showSearch"}],staticClass:"amap-search__autocomplate"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.autocomplateInput,expression:"autocomplateInput"}],attrs:{type:"text",id:"autocomplate-input",autocomplete:"off",placeholder:"输入详细地址,越详细定位越精准"},domProps:{value:e.autocomplateInput},on:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.searchDefaultSuggestion(t):null},input:function(t){t.target.composing||(e.autocomplateInput=t.target.value)}}}),e._v(" "),a("a",{staticClass:"amap-search__search-btn",on:{click:e.searchDefaultSuggestion}},[e._v("\n          搜索\n      ")])]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.selectedPoi.location.lat,expression:"selectedPoi.location.lat"}],ref:"marker-content",staticClass:"marker-content"},[a("div",{staticClass:"marker-content-header"},[a("span",{directives:[{name:"show",rawName:"v-show",value:0==e.selectedPoi.isMoved,expression:"selectedPoi.isMoved==false"}],staticClass:"notice-icon"},[e._v("⚑")]),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:0==e.selectedPoi.isMoved,expression:"selectedPoi.isMoved==false"}],staticClass:"notice"},[e._v("已将坐标定位为")]),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.selectedPoi.isMoved,expression:"selectedPoi.isMoved"}],staticClass:"notice"},[e._v("坐标定位")])]),e._v(" "),a("div",{staticClass:"marker-info"},[a("div",{staticClass:"marker-name"},[e._v(e._s(e.selectedPoi.name))]),e._v(" "),a("div",{staticClass:"marker-address"},[e._v(e._s(e.selectedPoi.address))])]),e._v(" "),a("a",{directives:[{name:"show",rawName:"v-show",value:e.selectedPoi.isMoved,expression:"selectedPoi.isMoved"}],staticClass:"amap-search__confirm-btn",on:{click:function(t){e.setMarkerLocation(e.selectedPoi)}}},[e._v("确定")])]),e._v(" "),a("div",{attrs:{id:"amap-container"}})])},staticRenderFns:[]}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.amapmixinApp={data:function(){return{map:{},autocomplete:{},placeSearch:{},amapCounty:{},geocoder:{},selectedPoi:{location:{lat:0,lng:0},address:"",name:"",isMoved:!0},editingPolygon:{},mouseTool:{}}},mounted:function(){},methods:{initAmap:function(e,t,a,o){var i=this;i.map=new AMap.Map(e,{resizeEnable:!0,zoom:14,dragEnable:o,center:t}),i.marker=new AMap.Marker({position:t,map:i.map,icon:a}),i.marker.setMap(i.map),AMap.plugin(["AMap.Geocoder","AMap.ToolBar","AMap.Scale"],function(){i.map.addControl(new AMap.ToolBar),i.map.addControl(new AMap.Scale)}),i.geocoder=new AMap.Geocoder({radius:1e3,extensions:"all"}),AMap.MouseTool&&(i.mouseTool=new AMap.MouseTool(i.map))},initAutocomplate:function(e,t,a){var o=this;AMap.plugin(["AMap.Geocoder","AMap.Autocomplete","AMap.PlaceSearch"],function(){var i={city:a&&"",input:e};o.autocomplete=new AMap.Autocomplete(i),o.placeSearch=new AMap.PlaceSearch({city:a,map:o.map,pageSize:t}),AMap.event.addListener(o.autocomplete,"select",function(e){console.log("autocomplate select event"),o.autocomplateInput=e.poi.name,o.placeSearch.search(e.poi.name,function(e,t){"complete"===e&&"OK"===t.info?(o.map.clearMap(),o.renderSearchMarker(t.poiList.pois),o.map.setFitView(),o.map.setZoom(16),o.placeSearch.clear()):console.log("没有匹配结果<br>或者结果太多")})})})},initMouseTools:function(){var e=this;e.mouseTool.marker(),e.mouseTool.on("draw",function(t){e.map.clearMap();var a=t.obj.getPosition();e.geocoder.getAddress(a,function(t,o){if("complete"===t&&"OK"===o.info){console.log(o);var i=o.regeocode.addressComponent,n={location:a,address:i.district+i.street+i.streetNumber,name:o.regeocode.formattedAddress};e.renderSearchMarker([n],!0)}})})},searchDefaultSuggestion:function(e){var t=this;t.placeSearch.search(this.autocomplateInput,function(e,a){"complete"===e&&"OK"===a.info?(t.map.clearMap(),t.renderSearchMarker(a.poiList.pois),t.map.setFitView(),t.map.setZoom(14),t.placeSearch.clear()):console.log("没有匹配结果<br>或者结果太多")})},renderSearchMarker:function(e){for(var t,a=this,o=new AMap.InfoWindow({offset:new AMap.Pixel(0,-30)}),i=0,n=0,s=e;n<s.length;n++){var r=s[n];!function(e){i++,t=new AMap.Marker({position:e.location,map:a.map,icon:"http://webapi.amap.com/theme/v1.3/markers/n/mark_r"+i+".png",draggable:!0}),t.content=a.$refs["marker-content"],t.setExtData({isMoved:!0,poiIndex:i}),t.on("click",function(t){a.selectedPoi.location=e.location,a.selectedPoi.address=e.address,a.selectedPoi.name=e.name,a.selectedPoi.isMoved=this.getExtData().isMoved,o.setContent(t.target.content),o.open(a.map,t.target.getPosition())}),t.on("dragstart",function(e){a.map.clearInfoWindow()}),t.on("dragend",function(e){var t=this;console.log(e.lnglat),t.setExtData({isMoved:!0});var i=e.lnglat.lat,n=e.lnglat.lng;t.setPosition(new AMap.LngLat(n,i)),a.geocoder.getAddress(e.lnglat,function(i,n){if("complete"===i&&"OK"===n.info){console.log(n);var s=n.regeocode.addressComponent;a.selectedPoi.location=e.lnglat,a.selectedPoi.address=s.district+s.street+s.streetNumber,a.selectedPoi.name=n.regeocode.formattedAddress,a.selectedPoi.isMoved=t.getExtData().isMoved,console.log(a.selectedPoi.name),o.setContent(e.target.content),o.open(a.map,e.target.getPosition())}})})}(r)}},initAMapDistrictSearch:function(e,t){var a=this;AMap.service("AMap.DistrictSearch",function(){var o={subdistrict:1,extensions:"base",showbiz:!1,level:"district"};new AMap.DistrictSearch(o).search(e,function(e,o){var i=o.districtList[0];a.map.setCenter(i.center),a.map.setZoom(14),t(i)})})},selectPeriphery:function(e,t,a,o){var i=this;i.placeSearch=new AMap.PlaceSearch({city:a,type:e,map:i.map,pageSize:o||10}),i.placeSearch.searchNearBy("",t,1e3,function(e,t){"complete"===e&&"OK"===t.info&&(i.map.clearMap(),i.renderSearchMarker(t.poiList.pois),i.map.setFitView(),i.map.setZoom(15),i.placeSearch.clear())})}}}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a(4);t.default={name:"amapSearch",data:function(){return{autocomplateInput:""}},watch:{autocomplateInput:function(e,t){this.$emit("userInput",e)},"selectedPoi.location.lat":function(e,t){if(this.autoConfirm){this.selectedPoi.isMoved=!1;var a=JSON.stringify(this.selectedPoi);this.$emit("pickedLocation",JSON.parse(a))}},selectType:function(e,t){this.defaultLat&&this.defaultLng&&this.selectPeriphery(this.selectType,[this.defaultLat,this.defaultLng],"上海",10)},defaultLng:function(){},defaultLat:function(){}},props:{defaultLng:{type:Number,required:!1},defaultLat:{type:Number,required:!1},defaultCity:{type:String,default:"上海",required:!1},searchCount:{type:Number,default:1,required:!1},width:{type:[String,Number],required:!0},height:{type:Number,required:!0},autoConfirm:{type:Boolean,default:!1,required:!1},icon:{type:String,default:"data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmlld0JveD0iLTkgMTAgMjEgMjIiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgLTkgMTAgMjEgMjI7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4gPHN0eWxlIHR5cGU9InRleHQvY3NzIj4gLnN0MHtmaWxsOm5vbmU7fSAuc3Qxe2ZpbGw6IzMzMzMzMztmaWxsLW9wYWNpdHk6MC41O30gLnN0MntmaWxsOiNGRjZGNUM7fSA8L3N0eWxlPiA8Zz4gPGVsbGlwc2UgY2xhc3M9InN0MCIgY3g9IjEuNSIgY3k9IjE4IiByeD0iNC4yMDAwMSIgcnk9IjQiLz4gPHBhdGggY2xhc3M9InN0MSIgZD0iTS0wLjA0ODgzLDI5LjA2MTM0Qy0yLjMzMTU0LDI5LjI0MzktNCwyOS44MTgzNi00LDMwLjVjMCwwLjgyODQzLDIuNDYyNDYsMS41LDUuNSwxLjVTNywzMS4zMjg0Myw3LDMwLjUgYzAtMC42ODE2NC0xLjY2ODQ2LTEuMjU2MS0zLjk1MTE3LTEuNDM4NjZDMi4xMjU0MywyOS42NjQzMSwxLjUwMDA2LDMwLDEuNTAwMDYsMzBTMC44NzQ2MywyOS42NjQzMS0wLjA0ODgzLDI5LjA2MTM0eiIvPiA8cGF0aCBjbGFzcz0ic3QyIiBkPSJNMTAuOTUwMDEsMTguNDE0NTVDMTAuOTUwMDEsMTMuNzY3MDksNi43MTk3MywxMCwxLjUwMDA2LDEwYy01LjIxOTc5LDAtOS40NTAwNywzLjc2NzA5LTkuNDUwMDcsOC40MTQ1NSBjMCw0Ljg2NTM2LDUuMjIxODYsOC44OTcyOCw3LjkwMTE4LDEwLjY0Njc5QzAuODc0NjMsMjkuNjY0MzEsMS41MDAwNiwzMCwxLjUwMDA2LDMwczAuNjI1MzctMC4zMzU2OSwxLjU0ODc3LTAuOTM4NjYgQzUuNzI4MDksMjcuMzExODMsMTAuOTUwMDEsMjMuMjc5OTEsMTAuOTUwMDEsMTguNDE0NTV6IE0xLjUsMjJjLTIuMzE5MTUsMC00LjIwMDAxLTEuNzkwNTMtNC4yMDAwMS00Uy0wLjgxOTE1LDE0LDEuNSwxNCBjMi4zMTkwOSwwLDQuMjAwMDEsMS43OTA1Myw0LjIwMDAxLDRDNS43MDAwMSwyMC4yMDk1MywzLjgxOTA5LDIyLDEuNSwyMnoiLz4gPC9nPiA8L3N2Zz4=",required:!1},dragEnable:{type:Boolean,default:!1},useClick:{type:Boolean,default:!1,required:!1},showSearch:{type:Boolean,default:!1,required:!1},selectType:{type:String,default:"",required:!1}},methods:{setMarkerLocation:function(){if(0==this.autoConfirm){this.selectedPoi.isMoved=!1;var e=JSON.stringify(this.selectedPoi);this.$emit("pickedLocation",JSON.parse(e))}},createScript:function(e){if(!window.amapConfig||!window.amapConfig.key)return console.error("No configuration for amap");var t=document.createElement("script");t.src="http://webapi.amap.com/maps?v=1.3&key="+window.amapConfig.key,t.id=""+window.amapConfig.key,t.onload=function(){setTimeout(function(){e(),console.log("AMap load ts")},1e3)},document.head.appendChild(t)},initMap:function(){if(this.defaultLng&&this.defaultLat){this.initAmap("amap-container",[this.defaultLat,this.defaultLng],this.icon,this.dragEnable);var e=this.autoConfirm?1:this.searchCount;this.useClick&&(this.initMouseTools(),e=1),this.initAutocomplate("autocomplate-input",e,this.defaultCity)}}},mounted:function(){var e=this;this.createScript(function(){e.initMap()})},mixins:[o.amapmixinApp]}},function(e,t,a){a(1);var o=a(2)(a(0),a(3),null,null);t.__esModule=!0,t.default=o.exports}])});
//# sourceMappingURL=main.js.map